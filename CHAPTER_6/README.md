# 온체인과 오프체인 데이터

</br>

## 목표
- 블록, 트랜잭션, 리시트, 스테이트 같은 여러 종류의 온체인 데이터에 대해 안다.
- 이벤트를 정의, 발생시키고 로그인할 줄 안다.
- Dapp 오퍼레이션을 지원하기 위한 트랜잭션 리스트로부터 이벤트 로그 접근할 수 있다.
- 온체인과 오프체인 데이터를 가진 Dapp설계하고 개발한다.
- ASK와 블라인드 경매 Dapp을 사용해 온체인과 오프체인 데이터를 시연할 수 있다.

</br>

---

</br>

Dapp에서 사용하는 데이터를 어디에 저장하고 있을까? 일부분은 블록체인 인프라(온체인)에 저장하고, 다른 것은 전통적인 데이터베이스와 파일(오프체인)에 저장한다. 일반적으로 블록체인상에 저장하는 모든 데이터는 온체인 데이터이고, 그 이외의 것은 오프체인데이터이다. 

블록체인 노드상에 저장하는 데이터
- 실행하고 컨펌받은 트랜잭션
- 스마트 컨트랙트 함수의 실행 겨로가
- 상태 변화(storage 변숫값에 일어난 변화)
- 발생시킨 이벤트 로그

이러한 데이터를 저장하고, 블록체인 프로토콜에서 설정한대로 다른 참여 노드로 전파한다.

-> <b>온체인 데이터(on-chain data)는</b> 블록체인 기반 애플리케이션이 구동한 트랜잭션이 생성한 정보와 블록체인의 구축(materialization)에 쓰인 아이템의 집합니다.

#### * 전통적인 애플리케이션과 온체인과 오프체인 데이터를 가진 블록체인 Dapp 비교

![image](https://user-images.githubusercontent.com/68188768/168093038-9fa36b6d-1030-4056-b609-9f8684b4c74b.png)
*왼쪽 부분은 통상적인 데이터 저장공간을 나타내고, 오른쪽 부분은 이 시스템에서 온체인 ㄴ데이터를 저장하는 블록체인을 추가해서 개선한 그림이다.*

일반적으로 컨트랙트 파트에서 생성한 데이터는 온체인에 저장하고, 앱 파트에서 생성하고 사용하는 데이터는 오프체인에 저장한다. Dapp의 함수 호출로 스마트 컨트랙트를 구동하여 Txs를 생성하면, 관련된 아티팩트는 블록체인에 기록된다.

</br>

## 1. 온체인 데이터

블록체인 프로토콜은 다음과 같은 여러 종류의 온체인 데이터로 구성된다.

![image](https://user-images.githubusercontent.com/68188768/168095834-f9e78356-bf4f-4755-97e5-15e920636603.png)

- 블록체인 헤더(6A)는 블록의 속성을 저장한다.
- 트랝개션(6B)은 블록에 저장된 Tx의 내용을 저장한다.
- 리시트(6C)는 블록에 기록된 Tx의 실행 결과를 저장한다. 모든 트랜잭션은 리시트를 가지고 있고, 그림과 같은 일대일 관계를 보여준다.
- 총합 글로벌 스테이트(6D)는 모든 블록체인상의 스마트 컨트랙트와 다른 일반 어카운트의 데이터 값 또는 현재 스테이트를 저장하고, 이것을 이용하는 Tx를 컴펌할 때 갱신한다.

아이템 6A가 아이템 6B, 6C, 6D의 해시를 포함(저장)한다. 이러한 아이템들의 해시가 현재 블록의 해시가된다. 현재 블록의 해시는 체인에 추가되는 다음 블록 해시를 구성하는 부분으로 저장된다. 이렇게 해서 블록의 해시가 그 다음(새로 추가되는) 블록의 일부가 됨으로써, 블록은 체인 링크를 형성한다.